```python
from pykrx import stock
from pykrx import bond
import FinanceDataReader as fdr
import yfinance as yf
import time

from IPython.display import Image
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns

import warnings
warnings.filterwarnings(action='ignore')
sns.set()


import talib.abstract as ta
from talib import MA_Type


import requests 
import json
from bs4 import BeautifulSoup 
import datetime 
from pandas.io.json import json_normalize
from sklearn.preprocessing import StandardScaler
from matplotlib.animation import FuncAnimation


#-------------------- 차트 관련 속성 (한글처리, 그리드) -----------
#plt.rc('font', family='NanumGothicOTF') # For MacOS
plt.rcParams['font.family']= 'Malgun Gothic'
plt.rcParams['axes.unicode_minus'] = False


#-------------------- 주피터 , 출력결과 넓이 늘리기 ---------------
from IPython.core.display import display, HTML
display(HTML("<style>.container{width:100% !important;}</style>"))
pd.set_option('display.max_rows', 100)
pd.set_option('display.max_columns', 100)
pd.set_option('max_colwidth', None)


```


<style>.container{width:100% !important;}</style>



```python
from pykrx import stock
# from pykrx import bond
```


```python
df = stock.get_index_ohlcv_by_date("19760102", "20231031", "1028")
print(df)
```

    코스피 200         시가      고가      저가      종가        거래량           거래대금  \
    날짜                                                                     
    1990-01-03    0.00    0.00    0.00  100.00    4024570              0   
    1990-01-04    0.00    0.00    0.00  102.00   10004880              0   
    1990-01-05    0.00    0.00    0.00  100.38   10657720              0   
    1990-01-06    0.00    0.00    0.00  100.02    5440870              0   
    1990-01-08    0.00    0.00    0.00  100.51    7805900              0   
    ...            ...     ...     ...     ...        ...            ...   
    2023-10-25  319.26  319.59  316.30  316.49   91218212  5990647874872   
    2023-10-26  311.36  312.37  307.75  307.75  110774427  7147843599760   
    2023-10-27  309.68  310.43  307.24  308.53   92934386  5978754499550   
    2023-10-30  307.01  310.12  306.89  308.95   95847666  4917393348916   
    2023-10-31  310.49  311.58  305.14  305.56  121721241  6285058452388   
    
    코스피 200               상장시가총액  
    날짜                            
    1990-01-03                 0  
    1990-01-04                 0  
    1990-01-05                 0  
    1990-01-06                 0  
    1990-01-08                 0  
    ...                      ...  
    2023-10-25  1638326343330425  
    2023-10-26  1594021634219925  
    2023-10-27  1597031432203450  
    2023-10-30  1601800798334580  
    2023-10-31  1580134815560475  
    
    [8768 rows x 7 columns]
    


```python
# tickers = stock.get_index_portfolio_deposit_file("KQ150")
# print(tickers)
```

    []
    


```python
# df_kq150 = fdr.DataReader('KQ150','2020-01-01','2022-07-15')
```

    HTTP Error 404: Not Found  - symbol "KQ150"not found or invalid periods
    


```python
df2 = stock.get_index_ohlcv_by_date("19760102", "20231031", "2203")
print(df2)
```

    코스닥 150          시가       고가       저가       종가       거래량           거래대금  \
    날짜                                                                        
    2010-01-04     0.00     0.00     0.00  1000.00         0              0   
    2010-01-05     0.00     0.00     0.00  1005.86         0              0   
    2010-01-06     0.00     0.00     0.00  1020.16         0              0   
    2010-01-07     0.00     0.00     0.00  1010.69         0              0   
    2010-01-08     0.00     0.00     0.00  1017.34         0              0   
    ...             ...      ...      ...      ...       ...            ...   
    2023-10-25  1251.63  1251.63  1208.37  1208.41  77715194  2431328571853   
    2023-10-26  1170.79  1185.09  1156.56  1160.79  69778933  2715254637081   
    2023-10-27  1175.67  1196.56  1156.03  1175.63  69418598  2479348097341   
    2023-10-30  1173.95  1197.93  1170.28  1189.29  48369139  1726472738492   
    2023-10-31  1188.45  1188.76  1144.50  1147.92  50799539  1959158683552   
    
    코스닥 150              상장시가총액  
    날짜                           
    2010-01-04                0  
    2010-01-05                0  
    2010-01-06                0  
    2010-01-07                0  
    2010-01-08                0  
    ...                     ...  
    2023-10-25  192954253773567  
    2023-10-26  185235604286077  
    2023-10-27  187800419270280  
    2023-10-30  190373571128497  
    2023-10-31  183737159616416  
    
    [3412 rows x 7 columns]
    

1001 코스피
1028 코스피 200
1034 코스피 100
1035 코스피 50
1167 코스피 200 중소형주
1182 코스피 200 초대형제외 지수
1244 코스피200제외 코스피지수
1150 코스피 200 커뮤니케이션서비스
1151 코스피 200 건설
1152 코스피 200 중공업
1153 코스피 200 철강/소재
1154 코스피 200 에너지/화학
1155 코스피 200 정보기술
1156 코스피 200 금융
1157 코스피 200 생활소비재
1158 코스피 200 경기소비재
1159 코스피 200 산업재
1160 코스피 200 헬스케어
1005 음식료품
1006 섬유의복
1007 종이목재
1008 화학
1009 의약품
1010 비금속광물
1011 철강금속
1012 기계
1013 전기전자
1014 의료정밀
1015 운수장비
1016 유통업
1017 전기가스업
1018 건설업
1019 운수창고업
1020 통신업
1021 금융업
1022 은행
1024 증권
1025 보험
1026 서비스업
1027 제조업
1002 코스피 대형주
1003 코스피 중형주
1004 코스피 소형주
1224 코스피 200 비중상한 30%
1227 코스피 200 비중상한 25%
1232 코스피 200 비중상한 20%
 

2001 코스닥
2203 코스닥 150
2216 코스닥 150 정보기술
2217 코스닥 150 헬스케어
2218 코스닥 150 커뮤니케이션서비스
2212 코스닥 150 소재
2213 코스닥 150 산업재
2214 코스닥 150 필수소비재
2215 코스닥 150 자유소비재
2012 기타서비스
2015 코스닥 IT
2024 제조
2026 건설
2027 유통
2029 운송
2031 금융
2037 오락,문화
2041 통신방송서비스
2042 IT S/W & SVC
2043 IT H/W
2056 음식료·담배
2058 섬유·의류
2062 종이·목재
2063 출판·매체복제
2065 화학
2066 제약
2067 비금속
2068 금속
2070 기계·장비
2072 일반전기전자
2074 의료·정밀기기
2075 운송장비·부품
2077 기타 제조
2151 통신서비스
2152 방송서비스
2153 인터넷
2154 디지털컨텐츠
2155 소프트웨어
2156 컴퓨터서비스
2157 통신장비
2158 정보기기
2159 반도체
2160 IT부품
2002 코스닥 대형주
2003 코스닥 중형주
2004 코스닥 소형주
2181 코스닥 우량기업부
2182 코스닥 벤처기업부
2183 코스닥 중견기업부
2184 코스닥 기술성장기업부


```python
pdf = stock.get_index_portfolio_deposit_file("2041")
print(len(pdf), pdf)
```

    20 ['035760', '025770', '040300', '122450', '451760', '036800', '048550', '058400', '066790', '036630', '039340', '408900', '039290', '033830', '066410', '065530', '115310', '039420', '052600', '131100']
    

# 인덱스 조회 API


```python
# 코스피 인덱스
tickers = stock.get_index_ticker_list()
print(len(tickers), tickers)
```

    46 ['1001', '1002', '1003', '1004', '1005', '1006', '1007', '1008', '1009', '1010', '1011', '1012', '1013', '1014', '1015', '1016', '1017', '1018', '1019', '1020', '1021', '1024', '1025', '1026', '1027', '1028', '1034', '1035', '1150', '1151', '1152', '1153', '1154', '1155', '1156', '1157', '1158', '1159', '1160', '1167', '1182', '1224', '1227', '1232', '1244', '1894']
    


```python
# 코스닥 인덱스
tickers = stock.get_index_ticker_list(market='KOSDAQ')
print(len(tickers), tickers)
```

    51 ['2001', '2002', '2003', '2004', '2012', '2015', '2024', '2026', '2027', '2029', '2031', '2037', '2041', '2042', '2043', '2056', '2058', '2062', '2063', '2065', '2066', '2067', '2068', '2070', '2072', '2074', '2075', '2077', '2151', '2152', '2153', '2154', '2155', '2156', '2157', '2158', '2159', '2160', '2181', '2182', '2183', '2184', '2189', '2203', '2212', '2213', '2214', '2215', '2216', '2217', '2218']
    


```python
for ticker in stock.get_index_ticker_list():
    print(ticker, stock.get_index_ticker_name(ticker))
```

    1001 코스피
    1002 코스피 대형주
    1003 코스피 중형주
    1004 코스피 소형주
    1005 음식료품
    1006 섬유의복
    1007 종이목재
    1008 화학
    1009 의약품
    1010 비금속광물
    1011 철강금속
    1012 기계
    1013 전기전자
    1014 의료정밀
    1015 운수장비
    1016 유통업
    1017 전기가스업
    1018 건설업
    1019 운수창고업
    1020 통신업
    1021 금융업
    1024 증권
    1025 보험
    1026 서비스업
    1027 제조업
    1028 코스피 200
    1034 코스피 100
    1035 코스피 50
    1150 코스피 200 커뮤니케이션서비스
    1151 코스피 200 건설
    1152 코스피 200 중공업
    1153 코스피 200 철강/소재
    1154 코스피 200 에너지/화학
    1155 코스피 200 정보기술
    1156 코스피 200 금융
    1157 코스피 200 생활소비재
    1158 코스피 200 경기소비재
    1159 코스피 200 산업재
    1160 코스피 200 헬스케어
    1167 코스피 200 중소형주
    1182 코스피 200 초대형제외 지수
    1224 코스피 200 비중상한 30%
    1227 코스피 200 비중상한 25%
    1232 코스피 200 비중상한 20%
    1244 코스피200제외 코스피지수
    1894 코스피 200 TOP 10
    


```python
for ticker in stock.get_index_ticker_list(market='KOSDAQ'):
    print(ticker, stock.get_index_ticker_name(ticker))
```

    2001 코스닥
    2002 코스닥 대형주
    2003 코스닥 중형주
    2004 코스닥 소형주
    2012 기타서비스
    2015 코스닥 IT
    2024 제조업
    2026 건설
    2027 유통
    2029 운송
    2031 금융
    2037 오락·문화
    2041 통신방송서비스
    2042 IT S/W & SVC
    2043 IT H/W
    2056 음식료·담배
    2058 섬유·의류
    2062 종이·목재
    2063 출판·매체복제
    2065 화학
    2066 제약
    2067 비금속
    2068 금속
    2070 기계·장비
    2072 일반전기전자
    2074 의료·정밀기기
    2075 운송장비·부품
    2077 기타제조
    2151 통신서비스
    2152 방송서비스
    2153 인터넷
    2154 디지털컨텐츠
    2155 소프트웨어
    2156 컴퓨터서비스
    2157 통신장비
    2158 정보기기
    2159 반도체
    2160 IT부품
    2181 코스닥 우량기업부
    2182 코스닥 벤처기업부
    2183 코스닥 중견기업부
    2184 코스닥 기술성장기업부
    2189 코스닥 글로벌
    2203 코스닥 150
    2212 코스닥 150 소재
    2213 코스닥 150 산업재
    2214 코스닥 150 필수소비재
    2215 코스닥 150 자유소비재
    2216 코스닥 150 정보기술
    2217 코스닥 150 헬스케어
    2218 코스닥 150 커뮤니케이션서비스
    


```python
df = stock.get_index_fundamental("19760102", "20231031", "1001")
print(df.head())
```

                   종가  등락률  PER  선행PER  PBR  배당수익률
    날짜                                            
    1976-01-05  87.77  0.0  0.0    0.0  0.0    0.0
    1976-01-06  89.94  0.0  0.0    0.0  0.0    0.0
    1976-01-07  89.84  0.0  0.0    0.0  0.0    0.0
    1976-01-08  88.93  0.0  0.0    0.0  0.0    0.0
    1976-01-09  89.80  0.0  0.0    0.0  0.0    0.0
    


```python
from openpyxl import Workbook

for ticker in stock.get_index_ticker_list(market="KRX"):   # () : 코스피, (market="KOSDAQ") : 코스닥
    ticker_name = stock.get_index_ticker_name(ticker)
    
    # 티커 이름에서 특수 문자와 공백을 제거하거나 대체
    filename = ticker_name.replace(' ', '_').replace('/', '_').replace('-', '_')
    
    print('해당티커 : ', ticker, '지수명 : ', ticker_name)
    
    df = stock.get_index_fundamental("19760102", "20231031", ticker)
    df.to_excel(f'{filename}_fundamental.xlsx')

```

    해당티커 :  5042 지수명 :  KRX 100
    해당티커 :  5043 지수명 :  KRX 자동차
    해당티커 :  5044 지수명 :  KRX 반도체
    해당티커 :  5045 지수명 :  KRX 헬스케어
    해당티커 :  5046 지수명 :  KRX 은행
    해당티커 :  5048 지수명 :  KRX 에너지화학
    해당티커 :  5049 지수명 :  KRX 철강
    해당티커 :  5051 지수명 :  KRX 방송통신
    해당티커 :  5052 지수명 :  KRX 건설
    해당티커 :  5054 지수명 :  KRX 증권
    해당티커 :  5055 지수명 :  KRX 기계장비
    해당티커 :  5056 지수명 :  KRX 보험
    해당티커 :  5057 지수명 :  KRX 운송
    해당티커 :  5061 지수명 :  KRX 경기소비재
    해당티커 :  5062 지수명 :  KRX 필수소비재
    해당티커 :  5063 지수명 :  KRX 미디어&엔터테인먼트
    해당티커 :  5064 지수명 :  KRX 정보기술
    해당티커 :  5065 지수명 :  KRX 유틸리티
    해당티커 :  5300 지수명 :  KRX 300
    해당티커 :  5351 지수명 :  KRX 300 정보기술
    해당티커 :  5352 지수명 :  KRX 300 금융
    해당티커 :  5353 지수명 :  KRX 300 자유소비재
    해당티커 :  5354 지수명 :  KRX 300 산업재
    해당티커 :  5355 지수명 :  KRX 300 헬스케어
    해당티커 :  5356 지수명 :  KRX 300 커뮤니케이션서비스
    해당티커 :  5357 지수명 :  KRX 300 소재
    해당티커 :  5358 지수명 :  KRX 300 필수소비재
    해당티커 :  5600 지수명 :  KTOP 30
    


```python

```


```python

```


```python

```
